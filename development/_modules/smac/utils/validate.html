<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>smac.utils.validate &mdash; SMAC 1.0.1 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> SMAC
            <img src="../../../_static/SMAC3.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/quickstart/quickstart_example.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage_recomendation.html">Usage Recommendation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../smac_examples.html">SMAC Examples</a><ul>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../manual.html">Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../basic_usage.html">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../options.html">Options and file formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tae.html">Target Algorithm Evaluator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../psmac.html">Parallel SMAC (pSMAC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../validation.html">Validation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.callbacks.html">smac.callbacks module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.configspace.html">smac.configspace package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.configspace.util.html">smac.configspace.util module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.epm.html">smac.epm package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.base_epm.html">smac.epm.base_epm module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.base_gp.html">smac.epm.base_gp module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.base_imputor.html">smac.epm.base_imputor module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.base_rf.html">smac.epm.base_rf module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.gaussian_process.html">smac.epm.gaussian_process module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.gaussian_process_mcmc.html">smac.epm.gaussian_process_mcmc module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.gp_base_prior.html">smac.epm.gp_base_prior module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.gp_kernels.html">smac.epm.gp_kernels module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.random_epm.html">smac.epm.random_epm module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.rf_with_instances.html">smac.epm.rf_with_instances module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.rfr_imputator.html">smac.epm.rfr_imputator module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.uncorrelated_mo_rf_with_instances.html">smac.epm.uncorrelated_mo_rf_with_instances module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.epm.util_funcs.html">smac.epm.util_funcs module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.facade.html">smac.facade package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.facade.experimental.html">smac.facade.experimental package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../apidoc/smac.facade.experimental.hydra_facade.html">smac.facade.experimental.hydra_facade module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../apidoc/smac.facade.experimental.psmac_facade.html">smac.facade.experimental.psmac_facade module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.facade.func_facade.html">smac.facade.func_facade module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.facade.hyperband_facade.html">smac.facade.hyperband_facade module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.facade.roar_facade.html">smac.facade.roar_facade module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.facade.smac_ac_facade.html">smac.facade.smac_ac_facade module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.facade.smac_bb_facade.html">smac.facade.smac_bb_facade module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.facade.smac_hpo_facade.html">smac.facade.smac_hpo_facade module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.facade.smac_mf_facade.html">smac.facade.smac_mf_facade module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.initial_design.html">smac.initial_design package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.initial_design.default_configuration_design.html">smac.initial_design.default_configuration_design module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.initial_design.factorial_design.html">smac.initial_design.factorial_design module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.initial_design.initial_design.html">smac.initial_design.initial_design module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.initial_design.latin_hypercube_design.html">smac.initial_design.latin_hypercube_design module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.initial_design.random_configuration_design.html">smac.initial_design.random_configuration_design module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.initial_design.sobol_design.html">smac.initial_design.sobol_design module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.intensification.html">smac.intensification package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.intensification.abstract_racer.html">smac.intensification.abstract_racer module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.intensification.hyperband.html">smac.intensification.hyperband module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.intensification.intensification.html">smac.intensification.intensification module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.intensification.parallel_scheduling.html">smac.intensification.parallel_scheduling module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.intensification.simple_intensifier.html">smac.intensification.simple_intensifier module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.intensification.successive_halving.html">smac.intensification.successive_halving module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.optimizer.html">smac.optimizer package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.optimizer.acquisition.html">smac.optimizer.acquisition module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.optimizer.ei_optimization.html">smac.optimizer.ei_optimization module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.optimizer.epm_configuration_chooser.html">smac.optimizer.epm_configuration_chooser module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.optimizer.pSMAC.html">smac.optimizer.pSMAC module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.optimizer.random_configuration_chooser.html">smac.optimizer.random_configuration_chooser module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.optimizer.smbo.html">smac.optimizer.smbo module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.runhistory.html">smac.runhistory package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.runhistory.runhistory.html">smac.runhistory.runhistory module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.runhistory.runhistory2epm.html">smac.runhistory.runhistory2epm module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.scenario.html">smac.scenario package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.scenario.scenario.html">smac.scenario.scenario module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.stats.html">smac.stats package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.stats.stats.html">smac.stats.stats module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.tae.html">smac.tae package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.tae.base.html">smac.tae.base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.tae.dask_runner.html">smac.tae.dask_runner module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.tae.execute_func.html">smac.tae.execute_func module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.tae.execute_ta_run_aclib.html">smac.tae.execute_ta_run_aclib module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.tae.execute_ta_run_hydra.html">smac.tae.execute_ta_run_hydra module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.tae.execute_ta_run_old.html">smac.tae.execute_ta_run_old module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.tae.serial_runner.html">smac.tae.serial_runner module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.utils.html">smac.utils package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.utils.io.html">smac.utils.io package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../apidoc/smac.utils.io.cmd_reader.html">smac.utils.io.cmd_reader module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../apidoc/smac.utils.io.input_reader.html">smac.utils.io.input_reader module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../apidoc/smac.utils.io.output_directory.html">smac.utils.io.output_directory module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../apidoc/smac.utils.io.output_writer.html">smac.utils.io.output_writer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../apidoc/smac.utils.io.traj_logging.html">smac.utils.io.traj_logging module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.utils.constants.html">smac.utils.constants module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.utils.dependencies.html">smac.utils.dependencies module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.utils.logging.html">smac.utils.logging module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.utils.merge_foreign_data.html">smac.utils.merge_foreign_data module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.utils.test_helpers.html">smac.utils.test_helpers module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../apidoc/smac.utils.validate.html">smac.utils.validate module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../apidoc/smac.smac_cli.html">smac.smac_cli module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">F.A.Q.</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">SMAC</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>smac.utils.validate</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for smac.utils.validate</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">smac.configspace</span> <span class="kn">import</span> <span class="n">Configuration</span><span class="p">,</span> <span class="n">convert_configurations_to_array</span>
<span class="kn">from</span> <span class="nn">smac.epm.rf_with_instances</span> <span class="kn">import</span> <span class="n">RandomForestWithInstances</span>
<span class="kn">from</span> <span class="nn">smac.epm.rfr_imputator</span> <span class="kn">import</span> <span class="n">RFRImputator</span>
<span class="kn">from</span> <span class="nn">smac.epm.util_funcs</span> <span class="kn">import</span> <span class="n">get_types</span>
<span class="kn">from</span> <span class="nn">smac.runhistory.runhistory</span> <span class="kn">import</span> <span class="n">RunHistory</span><span class="p">,</span> <span class="n">RunInfo</span><span class="p">,</span> <span class="n">RunKey</span><span class="p">,</span> <span class="n">RunValue</span><span class="p">,</span> <span class="n">StatusType</span>
<span class="kn">from</span> <span class="nn">smac.runhistory.runhistory2epm</span> <span class="kn">import</span> <span class="n">RunHistory2EPM4Cost</span>
<span class="kn">from</span> <span class="nn">smac.scenario.scenario</span> <span class="kn">import</span> <span class="n">Scenario</span>
<span class="kn">from</span> <span class="nn">smac.stats.stats</span> <span class="kn">import</span> <span class="n">Stats</span>
<span class="kn">from</span> <span class="nn">smac.tae.base</span> <span class="kn">import</span> <span class="n">BaseRunner</span>
<span class="kn">from</span> <span class="nn">smac.tae.execute_ta_run_old</span> <span class="kn">import</span> <span class="n">ExecuteTARunOld</span>
<span class="kn">from</span> <span class="nn">smac.utils.constants</span> <span class="kn">import</span> <span class="n">MAXINT</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Joshua Marben&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2017, ML4AAD&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;3-clause BSD&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Joshua Marben&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;joshua.marben@neptun.uni-freiburg.de&quot;</span>


<div class="viewcode-block" id="_unbound_tae_starter"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate._unbound_tae_starter">[docs]</a><span class="k">def</span> <span class="nf">_unbound_tae_starter</span><span class="p">(</span>
    <span class="n">tae</span><span class="p">:</span> <span class="n">BaseRunner</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">],</span> <span class="n">run_info</span><span class="p">:</span> <span class="n">RunInfo</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunValue</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unbound function to be used by joblibs Parallel, since directly passing the</span>
<span class="sd">    TAE results in pickling-problems.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tae: BaseRunner</span>
<span class="sd">        tae to be used</span>
<span class="sd">    runhistory: RunHistory</span>
<span class="sd">        runhistory to save</span>
<span class="sd">    run_info: RunInfo</span>
<span class="sd">        Config to be launched</span>
<span class="sd">    *args, **kwargs: various</span>
<span class="sd">        arguments to the tae</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tae_results: RunValue</span>
<span class="sd">        return from tae.start</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_info</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">tae</span><span class="o">.</span><span class="n">run_wrapper</span><span class="p">(</span><span class="n">run_info</span><span class="p">)</span>
    <span class="n">tae</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">submitted_ta_runs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">tae</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">finished_ta_runs</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">tae</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">ta_time_used</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">runhistory</span><span class="p">:</span>
        <span class="n">runhistory</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">config</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">cost</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
            <span class="n">instance_id</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
            <span class="n">budget</span><span class="o">=</span><span class="n">run_info</span><span class="o">.</span><span class="n">budget</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tae</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">n_configs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">runhistory</span><span class="o">.</span><span class="n">config_ids</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span></div>


<span class="n">_Run</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Run&#39;</span><span class="p">,</span> <span class="s1">&#39;config inst seed inst_specs&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Validator"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator">[docs]</a><span class="k">class</span> <span class="nc">Validator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validator for the output of SMAC-scenarios.</span>
<span class="sd">    Evaluates specified configurations on specified instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">scenario</span><span class="p">:</span> <span class="n">Scenario</span><span class="p">,</span>
                 <span class="n">trajectory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">],</span>
                 <span class="n">rng</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct Validator for given scenario and trajectory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scenario: Scenario</span>
<span class="sd">            scenario object for cutoff, instances, features and specifics</span>
<span class="sd">        trajectory: trajectory-list</span>
<span class="sd">            trajectory to take incumbent(s) from</span>
<span class="sd">        rng: np.random.RandomState or int</span>
<span class="sd">            Random number generator or seed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">traj</span> <span class="o">=</span> <span class="n">trajectory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scen</span> <span class="o">=</span> <span class="n">scenario</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epm</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: typing.Optional[RandomForestWithInstances]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">rng</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;no seed given, using default seed of 1&#39;</span><span class="p">)</span>
            <span class="n">num_run</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">num_run</span><span class="p">)</span>

<div class="viewcode-block" id="Validator._save_results"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator._save_results">[docs]</a>    <span class="k">def</span> <span class="nf">_save_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rh</span><span class="p">:</span> <span class="n">RunHistory</span><span class="p">,</span>
        <span class="n">output_fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">backup_fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Helper to save results to file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rh: RunHistory</span>
<span class="sd">            runhistory to save</span>
<span class="sd">        output_fn: str</span>
<span class="sd">            if ends on &#39;.json&#39;: filename to save history to</span>
<span class="sd">            else: directory to save runhistory to (filename is backup_fn)</span>
<span class="sd">        backup_fn: str</span>
<span class="sd">            if output_fn does not end on &#39;.json&#39;, treat output_fn as dir and</span>
<span class="sd">            append backup_fn as filename (if output_fn ends on &#39;.json&#39;, this</span>
<span class="sd">            argument is ignored)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_fn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No output specified, validated runhistory not saved.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Check if a folder or a file is specified as output</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">backup_fn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;If output_fn does not end with .json the argument backup_fn needs to be given.&#39;</span><span class="p">)</span>
            <span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_fn</span>
            <span class="n">output_fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">backup_fn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Output is </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">, changing to </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">!&quot;</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">output_fn</span><span class="p">)</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">output_fn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">base</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Folder (</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">) doesn&#39;t exist, creating.&quot;</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
        <span class="n">rh</span><span class="o">.</span><span class="n">save_json</span><span class="p">(</span><span class="n">output_fn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saving validation-results in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output_fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Validator.validate"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">config_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;def&#39;</span><span class="p">,</span>
                 <span class="n">instance_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
                 <span class="n">repetitions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;threading&#39;</span><span class="p">,</span>
                 <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">tae</span><span class="p">:</span> <span class="n">BaseRunner</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">output_fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunHistory</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate configs on instances and save result in runhistory.</span>
<span class="sd">        If a runhistory is provided as input it is important that you run it on the same/comparable hardware.</span>

<span class="sd">        side effect: if output is specified, saves runhistory to specified</span>
<span class="sd">        output directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config_mode: str or list&lt;Configuration&gt;</span>
<span class="sd">            string or directly a list of Configuration.</span>
<span class="sd">            string from [def, inc, def+inc, wallclock_time, cpu_time, all].</span>
<span class="sd">            time evaluates at cpu- or wallclock-timesteps of:</span>
<span class="sd">            [max_time/2^0, max_time/2^1, max_time/2^3, ..., default]</span>
<span class="sd">            with max_time being the highest recorded time</span>
<span class="sd">        instance_mode: str or list&lt;str&gt;</span>
<span class="sd">            what instances to use for validation, either from</span>
<span class="sd">            [train, test, train+test] or directly a list of instances</span>
<span class="sd">        repetitions: int</span>
<span class="sd">            number of repetitions in nondeterministic algorithms</span>
<span class="sd">        n_jobs: int</span>
<span class="sd">            number of parallel processes used by joblib</span>
<span class="sd">        backend: str</span>
<span class="sd">            what backend joblib should use for parallel runs</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            optional, RunHistory-object to reuse runs</span>
<span class="sd">        tae: BaseRunner</span>
<span class="sd">            tae to be used. if None, will initialize ExecuteTARunOld</span>
<span class="sd">        output_fn: str</span>
<span class="sd">            path to runhistory to be saved. if the suffix is not &#39;.json&#39;, will</span>
<span class="sd">            be interpreted as directory and filename will be</span>
<span class="sd">            &#39;validated_runhistory.json&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            runhistory with validated runs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Validating configs &#39;</span><span class="si">%s</span><span class="s2">&#39; on instances &#39;</span><span class="si">%s</span><span class="s2">&#39;, repeating </span><span class="si">%d</span><span class="s2"> times&quot;</span>
                          <span class="s2">&quot; with </span><span class="si">%d</span><span class="s2"> parallel runs on backend &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
                          <span class="n">config_mode</span><span class="p">,</span> <span class="n">instance_mode</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>

        <span class="c1"># Get all runs to be evaluated as list</span>
        <span class="n">runs</span><span class="p">,</span> <span class="n">validated_rh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_runs</span><span class="p">(</span><span class="n">config_mode</span><span class="p">,</span> <span class="n">instance_mode</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">)</span>

        <span class="c1"># Create new Stats without limits</span>
        <span class="n">inf_scen</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">({</span>
            <span class="s1">&#39;run_obj&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">run_obj</span><span class="p">,</span>
            <span class="s1">&#39;cutoff_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cutoff</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
            <span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">})</span>
        <span class="n">inf_stats</span> <span class="o">=</span> <span class="n">Stats</span><span class="p">(</span><span class="n">inf_scen</span><span class="p">)</span>
        <span class="n">inf_stats</span><span class="o">.</span><span class="n">start_timing</span><span class="p">()</span>

        <span class="c1"># Create TAE</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tae</span><span class="p">:</span>
            <span class="n">tae</span> <span class="o">=</span> <span class="n">ExecuteTARunOld</span><span class="p">(</span><span class="n">ta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">ta</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                                  <span class="n">stats</span><span class="o">=</span><span class="n">inf_stats</span><span class="p">,</span>
                                  <span class="n">run_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">run_obj</span><span class="p">,</span>
                                  <span class="n">par_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">par_factor</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                                  <span class="n">cost_for_crash</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cost_for_crash</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Inject endless-stats</span>
            <span class="n">tae</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="n">inf_stats</span>

        <span class="c1"># Validate!</span>
        <span class="n">run_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_parallel</span><span class="p">(</span><span class="n">tae</span><span class="p">,</span> <span class="n">runs</span><span class="p">,</span> <span class="n">n_jobs</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">run_results</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="p">(</span><span class="n">run_results</span><span class="p">,</span> <span class="n">runs</span><span class="p">)</span>

        <span class="c1"># tae returns (status, cost, runtime, additional_info)</span>
        <span class="c1"># Add runs to RunHistory</span>
        <span class="k">for</span> <span class="n">run</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">run_results</span><span class="p">):</span>
            <span class="n">validated_rh</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                             <span class="n">cost</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">cost</span><span class="p">,</span>
                             <span class="n">time</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                             <span class="n">status</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                             <span class="n">instance_id</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span>
                             <span class="n">seed</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
                             <span class="n">additional_info</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">additional_info</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_save_results</span><span class="p">(</span><span class="n">validated_rh</span><span class="p">,</span> <span class="n">output_fn</span><span class="p">,</span> <span class="n">backup_fn</span><span class="o">=</span><span class="s2">&quot;validated_runhistory.json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validated_rh</span></div>

<div class="viewcode-block" id="Validator._validate_parallel"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator._validate_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">_validate_parallel</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tae</span><span class="p">:</span> <span class="n">BaseRunner</span><span class="p">,</span>
        <span class="n">runs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_Run</span><span class="p">],</span>
        <span class="n">n_jobs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">backend</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">RunValue</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate runs with joblibs Parallel-interface</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tae: BaseRunner</span>
<span class="sd">            tae to be used for validation</span>
<span class="sd">        runs: list&lt;_Run&gt;</span>
<span class="sd">            list with _Run-objects</span>
<span class="sd">            [_Run(config=CONFIG1,inst=INSTANCE1,seed=SEED1,inst_specs=INST_SPECIFICS1), ...]</span>
<span class="sd">        n_jobs: int</span>
<span class="sd">            number of cpus to use for validation (-1 to use all)</span>
<span class="sd">        backend: str</span>
<span class="sd">            what backend to use for parallelization</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            optional, RunHistory-object to reuse runs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        run_results: list&lt;tuple(tae-returns)&gt;</span>
<span class="sd">            results as returned by tae</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Runs with parallel</span>
        <span class="n">run_results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">)(</span>
            <span class="n">delayed</span><span class="p">(</span><span class="n">_unbound_tae_starter</span><span class="p">)(</span>
                <span class="n">tae</span><span class="p">,</span>
                <span class="n">runhistory</span><span class="p">,</span>
                <span class="n">RunInfo</span><span class="p">(</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                    <span class="n">instance</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span>
                    <span class="n">instance_specific</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">seed</span><span class="p">,</span>
                    <span class="n">cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cutoff</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                    <span class="n">capped</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">budget</span><span class="o">=</span><span class="mi">0</span>
                <span class="p">)</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">runs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">run_results</span></div>

<div class="viewcode-block" id="Validator.validate_epm"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator.validate_epm">[docs]</a>    <span class="k">def</span> <span class="nf">validate_epm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">config_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;def&#39;</span><span class="p">,</span>
                     <span class="n">instance_mode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
                     <span class="n">repetitions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">output_fn</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">reuse_epm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RunHistory</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use EPM to predict costs/runtimes for unknown config/inst-pairs.</span>

<span class="sd">        side effect: if output is specified, saves runhistory to specified</span>
<span class="sd">        output directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_fn: str</span>
<span class="sd">            path to runhistory to be saved. if the suffix is not &#39;.json&#39;, will</span>
<span class="sd">            be interpreted as directory and filename will be</span>
<span class="sd">            &#39;validated_runhistory_EPM.json&#39;</span>
<span class="sd">        config_mode: str or list&lt;Configuration&gt;</span>
<span class="sd">            string or directly a list of Configuration, string from [def, inc, def+inc, wallclock_time, cpu_time, all].</span>
<span class="sd">            time evaluates at cpu- or wallclock-timesteps of:</span>
<span class="sd">            [max_time/2^0, max_time/2^1, max_time/2^3, ..., default] with max_time being the highest recorded time</span>
<span class="sd">        instance_mode: str or list&lt;str&gt;</span>
<span class="sd">            what instances to use for validation, either from</span>
<span class="sd">            [train, test, train+test] or directly a list of instances</span>
<span class="sd">        repetitions: int</span>
<span class="sd">            number of repetitions in nondeterministic algorithms</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            optional, RunHistory-object to reuse runs</span>
<span class="sd">        reuse_epm: bool</span>
<span class="sd">            if true (and if `self.epm`), reuse epm to validate runs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            runhistory with predicted runs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">runhistory</span><span class="p">,</span> <span class="n">RunHistory</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epm</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">reuse_epm</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No runhistory specified for validating with EPM!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">reuse_epm</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">epm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Create RandomForest</span>
            <span class="n">types</span><span class="p">,</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">get_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
            <span class="n">epm</span> <span class="o">=</span> <span class="n">RandomForestWithInstances</span><span class="p">(</span>
                <span class="n">configspace</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">,</span>
                <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                <span class="n">instance_features</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span><span class="p">,</span>
                <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">MAXINT</span><span class="p">),</span>
                <span class="n">ratio_features</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Use imputor if objective is runtime</span>
            <span class="n">imputor</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">impute_state</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">impute_censored_data</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">run_obj</span> <span class="o">==</span> <span class="s1">&#39;runtime&#39;</span><span class="p">:</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">par_factor</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                <span class="n">imputor</span> <span class="o">=</span> <span class="n">RFRImputator</span><span class="p">(</span><span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span>
                                       <span class="n">cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cutoff</span><span class="p">,</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                                       <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                                       <span class="n">model</span><span class="o">=</span><span class="n">epm</span><span class="p">)</span>
                <span class="n">impute_censored_data</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">impute_state</span> <span class="o">=</span> <span class="p">[</span><span class="n">StatusType</span><span class="o">.</span><span class="n">CAPPED</span><span class="p">]</span>
                <span class="n">success_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">StatusType</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">StatusType</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">StatusType</span><span class="o">.</span><span class="n">CRASHED</span><span class="p">,</span> <span class="n">StatusType</span><span class="o">.</span><span class="n">MEMOUT</span><span class="p">]</span>

            <span class="c1"># Transform training data (from given rh)</span>
            <span class="n">rh2epm</span> <span class="o">=</span> <span class="n">RunHistory2EPM4Cost</span><span class="p">(</span><span class="n">num_params</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">get_hyperparameters</span><span class="p">()),</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
                                         <span class="n">scenario</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="p">,</span>
                                         <span class="n">impute_censored_data</span><span class="o">=</span><span class="n">impute_censored_data</span><span class="p">,</span>
                                         <span class="n">imputor</span><span class="o">=</span><span class="n">imputor</span><span class="p">,</span>
                                         <span class="n">impute_state</span><span class="o">=</span><span class="n">impute_state</span><span class="p">,</span>
                                         <span class="n">success_states</span><span class="o">=</span><span class="n">success_states</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">runhistory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># please mypy</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">rh2epm</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">runhistory</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Training model with data of shape X: </span><span class="si">%s</span><span class="s2">, y:</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="c1"># Train random forest</span>
            <span class="n">epm</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">epm</span> <span class="o">=</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">RandomForestWithInstances</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epm</span><span class="p">)</span>

        <span class="c1"># Predict desired runs</span>
        <span class="n">runs</span><span class="p">,</span> <span class="n">rh_epm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_runs</span><span class="p">(</span><span class="n">config_mode</span><span class="p">,</span> <span class="n">instance_mode</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">)</span>

        <span class="n">feature_array_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">get_hyperparameters</span><span class="p">())</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">feature_array_size</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">X_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="n">feature_array_size</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">run</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">run</span><span class="o">.</span><span class="n">inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">X_pred</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">convert_configurations_to_array</span><span class="p">([</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">feature_dict</span><span class="p">[</span><span class="n">run</span><span class="o">.</span><span class="n">inst</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">X_pred</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_configurations_to_array</span><span class="p">([</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Predicting desired </span><span class="si">%d</span><span class="s2"> runs, data has shape </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">X_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">epm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_pred</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epm</span> <span class="o">=</span> <span class="n">epm</span>

        <span class="c1"># Add runs to runhistory</span>
        <span class="k">for</span> <span class="n">run</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">rh_epm</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
                       <span class="n">cost</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span>
                       <span class="n">time</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">pred</span><span class="p">),</span>
                       <span class="n">status</span><span class="o">=</span><span class="n">StatusType</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span>
                       <span class="n">instance_id</span><span class="o">=</span><span class="n">run</span><span class="o">.</span><span class="n">inst</span><span class="p">,</span>
                       <span class="n">seed</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                       <span class="n">additional_info</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;additional_info&quot;</span><span class="p">:</span>
                                        <span class="s2">&quot;ESTIMATED USING EPM!&quot;</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">output_fn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_results</span><span class="p">(</span><span class="n">rh_epm</span><span class="p">,</span> <span class="n">output_fn</span><span class="p">,</span> <span class="n">backup_fn</span><span class="o">=</span><span class="s2">&quot;validated_runhistory_EPM.json&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rh_epm</span></div>

<div class="viewcode-block" id="Validator._get_runs"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator._get_runs">[docs]</a>    <span class="k">def</span> <span class="nf">_get_runs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">configs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]],</span>
                  <span class="n">insts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                  <span class="n">repetitions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">runhistory</span><span class="p">:</span> <span class="n">RunHistory</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_Run</span><span class="p">],</span> <span class="n">RunHistory</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot; Generate list of SMAC-TAE runs to be executed. This means</span>
<span class="sd">        combinations of configs with all instances on a certain number of seeds.</span>

<span class="sd">        side effect: Adds runs that don&#39;t need to be reevaluated to self.rh!</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        configs: str or list&lt;Configuration&gt;</span>
<span class="sd">            string or directly a list of Configuration</span>
<span class="sd">            str from [def, inc, def+inc, wallclock_time, cpu_time, all]</span>
<span class="sd">            time evaluates at cpu- or wallclock-timesteps of:</span>
<span class="sd">            [max_time/2^0, max_time/2^1, max_time/2^3, ..., default]</span>
<span class="sd">            with max_time being the highest recorded time</span>
<span class="sd">        insts: str or list&lt;str&gt;</span>
<span class="sd">            what instances to use for validation, either from</span>
<span class="sd">            [train, test, train+test] or directly a list of instances</span>
<span class="sd">        repetitions: int</span>
<span class="sd">            number of seeds per instance/config-pair to be evaluated</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            optional, try to reuse this runhistory and save some runs</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        runs: list&lt;_Run&gt;</span>
<span class="sd">            list with _Runs</span>
<span class="sd">            [_Run(config=CONFIG1,inst=INSTANCE1,seed=SEED1,inst_specs=INST_SPECIFICS1),</span>
<span class="sd">             _Run(config=CONFIG2,inst=INSTANCE2,seed=SEED2,inst_specs=INST_SPECIFICS2),</span>
<span class="sd">             ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get relevant configurations and instances</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_configs</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">insts</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_instances</span><span class="p">(</span><span class="n">insts</span><span class="p">))</span>  <span class="c1"># type: typing.Sequence[typing.Union[str, None]]</span>
        <span class="k">elif</span> <span class="n">insts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">insts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="c1"># If no instances are given, fix the instances to one &quot;None&quot; instance</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">instances</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>

        <span class="c1"># If algorithm is deterministic, fix repetitions to 1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">deterministic</span> <span class="ow">and</span> <span class="n">repetitions</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Specified </span><span class="si">%d</span><span class="s2"> repetitions, but fixing to 1, &quot;</span>
                                <span class="s2">&quot;because algorithm is deterministic.&quot;</span><span class="p">,</span> <span class="n">repetitions</span><span class="p">)</span>
            <span class="n">repetitions</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Extract relevant information from given runhistory</span>
        <span class="n">inst_seed_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_runhistory</span><span class="p">(</span><span class="n">configs</span><span class="p">,</span> <span class="n">instances</span><span class="p">,</span> <span class="n">runhistory</span><span class="p">)</span>

        <span class="c1"># Now create the actual run-list</span>
        <span class="n">runs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Counter for runs without the need of recalculation</span>
        <span class="n">runs_from_rh</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># If we reuse runs, we want to return them as well</span>
        <span class="n">new_rh</span> <span class="o">=</span> <span class="n">RunHistory</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repetitions</span><span class="p">):</span>
                <span class="c1"># First, find a seed and add all the data we can take from the</span>
                <span class="c1"># given runhistory to &quot;our&quot; validation runhistory.</span>
                <span class="n">configs_evaluated</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: Configuration</span>
                <span class="k">if</span> <span class="n">runhistory</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inst_seed_config</span><span class="p">:</span>
                    <span class="c1"># Choose seed based on most often evaluated inst-seed-pair</span>
                    <span class="n">seed</span><span class="p">,</span> <span class="n">configs_evaluated</span> <span class="o">=</span> <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="c1"># Delete inst if all seeds are used</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">inst_seed_config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="c1"># Add runs to runhistory</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">configs_evaluated</span><span class="p">[:]:</span>
                        <span class="n">runkey</span> <span class="o">=</span> <span class="n">RunKey</span><span class="p">(</span><span class="n">runhistory</span><span class="o">.</span><span class="n">config_ids</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
                        <span class="n">cost</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">additional_info</span> <span class="o">=</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">runkey</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">StatusType</span><span class="o">.</span><span class="n">CRASHED</span><span class="p">,</span> <span class="n">StatusType</span><span class="o">.</span><span class="n">ABORT</span><span class="p">,</span> <span class="n">StatusType</span><span class="o">.</span><span class="n">CAPPED</span><span class="p">]:</span>
                            <span class="c1"># Not properly executed target algorithm runs should be repeated</span>
                            <span class="n">configs_evaluated</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                            <span class="k">continue</span>
                        <span class="n">new_rh</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">cost</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">instance_id</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                                   <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">starttime</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">endtime</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                                   <span class="n">additional_info</span><span class="o">=</span><span class="n">additional_info</span><span class="p">)</span>
                        <span class="n">runs_from_rh</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># If no runhistory or no entries for instance, get new seed</span>
                    <span class="n">seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">MAXINT</span><span class="p">)</span>

                <span class="c1"># We now have a seed and add all configs that are not already</span>
                <span class="c1"># evaluated on that seed to the runs-list. This way, we</span>
                <span class="c1"># guarantee the same inst-seed-pairs for all configs.</span>
                <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">configs</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">configs_evaluated</span><span class="p">]:</span>
                    <span class="c1"># Only use specifics if specific exists, else use string &quot;0&quot;</span>
                    <span class="n">specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">instance_specific</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">instance_specific</span> <span class="k">else</span> <span class="s2">&quot;0&quot;</span>
                    <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_Run</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                                     <span class="n">inst</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                                     <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span>
                                     <span class="n">inst_specs</span><span class="o">=</span><span class="n">specs</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Collected </span><span class="si">%d</span><span class="s2"> runs from </span><span class="si">%d</span><span class="s2"> configurations on </span><span class="si">%d</span><span class="s2"> &quot;</span>
                         <span class="s2">&quot;instances with </span><span class="si">%d</span><span class="s2"> repetitions. Reusing </span><span class="si">%d</span><span class="s2"> runs from &quot;</span>
                         <span class="s2">&quot;given runhistory.&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">),</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">),</span> <span class="n">repetitions</span><span class="p">,</span> <span class="n">runs_from_rh</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">runs</span><span class="p">,</span> <span class="n">new_rh</span></div>

<div class="viewcode-block" id="Validator._process_runhistory"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator._process_runhistory">[docs]</a>    <span class="k">def</span> <span class="nf">_process_runhistory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configs</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">],</span>
        <span class="n">insts</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">runhistory</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">RunHistory</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Configuration</span><span class="p">]]]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes runhistory from self._get_runs by extracting already evaluated</span>
<span class="sd">        (relevant) config-inst-seed tuples.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        configs: list(Configuration)</span>
<span class="sd">            list of configs of interest</span>
<span class="sd">        insts: list(str)</span>
<span class="sd">            list of instances of interest</span>
<span class="sd">        runhistory: RunHistory</span>
<span class="sd">            runhistory to extract runs from</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        inst_seed_config: dict&lt;str : list(tuple(int, tuple(configs)))&gt;</span>
<span class="sd">            dictionary mapping instances to a list of tuples of already used</span>
<span class="sd">            seeds and the configs that this inst-seed-pair has been evaluated</span>
<span class="sd">            on, sorted by the number of configs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We want to reuse seeds that have been used on most configurations</span>
        <span class="c1"># To this end, we create a dictionary as {instances:{seed:[configs]}}</span>
        <span class="c1"># Like this we can easily retrieve the most used instance-seed pairs to</span>
        <span class="c1"># minimize the number of runs to be evaluated</span>
        <span class="k">if</span> <span class="n">runhistory</span><span class="p">:</span>
            <span class="n">inst_seed_config</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: typing.Dict[str, typing.Dict[int, typing.List[Configuration]]]</span>
            <span class="n">relevant</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">runhistory</span><span class="o">.</span><span class="n">ids_config</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">config_id</span><span class="p">]</span> <span class="ow">in</span> <span class="n">configs</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">instance_id</span> <span class="ow">in</span> <span class="n">insts</span><span class="p">):</span>
                    <span class="n">relevant</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="c1"># Change data-structure to {instances:[(seed1, (configs)), (seed2, (configs), ... ]}</span>
            <span class="c1"># to make most used seed easily accessible, we sort after length of configs</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">relevant</span><span class="p">:</span>
                <span class="n">inst</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">instance_id</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">seed</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">runhistory</span><span class="o">.</span><span class="n">ids_config</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">config_id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">inst_seed_config</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">inst</span><span class="p">]:</span>
                        <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">inst</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">inst</span><span class="p">][</span><span class="n">seed</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">config</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">inst</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">seed</span><span class="p">:</span> <span class="p">[</span><span class="n">config</span><span class="p">]}</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="n">i</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">inst_seed_config</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">seed</span><span class="p">]))</span> <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="n">inst_seed_config</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inst_seed_config</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rval</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: typing.Dict[str, typing.List[typing.Tuple[int, typing.List[Configuration]]]]</span>
            <span class="k">return</span> <span class="n">rval</span></div>

<div class="viewcode-block" id="Validator._get_configs"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator._get_configs">[docs]</a>    <span class="k">def</span> <span class="nf">_get_configs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return desired configs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode: str</span>
<span class="sd">            str from [def, inc, def+inc, wallclock_time, cpu_time, all]</span>
<span class="sd">                time evaluates at cpu- or wallclock-timesteps of:</span>
<span class="sd">                [max_time/2^0, max_time/2^1, max_time/2^3, ..., default]</span>
<span class="sd">                with max_time being the highest recorded time</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        configs: list&lt;Configuration&gt;</span>
<span class="sd">            list with desired configurations</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get trajectory and make sure it&#39;s not None to please mypy</span>
        <span class="n">traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">traj</span>
        <span class="k">assert</span> <span class="n">traj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># please mypy</span>

        <span class="c1"># Add desired configs</span>
        <span class="n">configs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;def&#39;</span><span class="p">,</span> <span class="s1">&#39;inc&#39;</span><span class="p">,</span> <span class="s1">&#39;def+inc&#39;</span><span class="p">,</span> <span class="s1">&#39;wallclock_time&#39;</span><span class="p">,</span> <span class="s1">&#39;cpu_time&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;all&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not a valid option for config_mode in validation.&quot;</span>
                             <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;def&quot;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;def+inc&quot;</span><span class="p">:</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">get_default_configuration</span><span class="p">())</span>  <span class="c1"># type: ignore[attr-defined] # noqa F821</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;inc&quot;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;def+inc&quot;</span><span class="p">:</span>
            <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;incumbent&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;wallclock_time&quot;</span><span class="p">,</span> <span class="s2">&quot;cpu_time&quot;</span><span class="p">]:</span>
            <span class="c1"># get highest time-entry and add entries from there</span>
            <span class="c1"># not using wallclock_limit in case it&#39;s inf</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;wallclock_time&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">wallclock_limit</span><span class="p">)):</span>
                <span class="n">max_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">wallclock_limit</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;cpu_time&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">algo_runs_timelimit</span><span class="p">)):</span>
                <span class="n">max_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">algo_runs_timelimit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_time</span> <span class="o">=</span> <span class="n">traj</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">mode</span><span class="p">]</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max_time</span> <span class="o">/</span> <span class="n">counter</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;incumbent&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">):</span>
                    <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;incumbent&quot;</span><span class="p">])</span>
                    <span class="n">counter</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">traj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;incumbent&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
                <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">traj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;incumbent&quot;</span><span class="p">])</span>  <span class="c1"># add first</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">traj</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;incumbent&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">configs</span><span class="p">:</span>
                    <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;incumbent&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Gathered </span><span class="si">%d</span><span class="s2"> configurations for mode </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                          <span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">),</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">configs</span></div>

<div class="viewcode-block" id="Validator._get_instances"><a class="viewcode-back" href="../../../apidoc/smac.utils.validate.html#smac.utils.validate.Validator._get_instances">[docs]</a>    <span class="k">def</span> <span class="nf">_get_instances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get desired instances</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode: str</span>
<span class="sd">            what instances to use for validation, from [train, test, train+test]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        instances: list&lt;str&gt;</span>
<span class="sd">            instances to be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;train+test&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not a valid option for instance_mode in validation.&quot;</span>
                             <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>

        <span class="c1"># Make sure if instances matter, than instances should be passed</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">instance_mode</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">train_insts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">instance_mode</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">test_insts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Instance mode is set to </span><span class="si">%s</span><span class="s2">, but there are no &quot;</span>
                                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-instances specified in the scenario. Setting instance mode to&quot;</span>
                                <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">train+test</span><span class="se">\&quot;</span><span class="s2">!&quot;</span><span class="p">,</span> <span class="n">instance_mode</span><span class="p">,</span> <span class="n">instance_mode</span><span class="p">)</span>
            <span class="n">instance_mode</span> <span class="o">=</span> <span class="s1">&#39;train+test&#39;</span>

        <span class="n">instances</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: typing.List[str]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">instance_mode</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span> <span class="ow">or</span> <span class="n">instance_mode</span> <span class="o">==</span> <span class="s1">&#39;train+test&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">train_insts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
            <span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">train_insts</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">instance_mode</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span> <span class="ow">or</span> <span class="n">instance_mode</span> <span class="o">==</span> <span class="s1">&#39;train+test&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">test_insts</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]:</span>
            <span class="n">instances</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scen</span><span class="o">.</span><span class="n">test_insts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instances</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2021, Marius Lindauer, Katharina Eggensperger, Matthias Feurer, Andr Biedenkapp, Difan Deng, Carolin Benjamins, Ren Sass and Frank Hutter.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>